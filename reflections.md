# REST

I denna uppgift har jag använt mig av repositorypattern för att lösa hur resurser används. Jag tycker att repositorypattern bidrar till att få en mer strukturerad kod då man enkelt kan se vart alla metoder ligger om man t.ex. ska göra ändringar i en metod för filmstudios. Nackdelen kan vara att det blir fler filer och kan upplevas som rörigt då det blir väldigt många filer.

För att lättare förstå hur jag har implementerat detta i kod kan jag ta ett exempel, ett PUT-anrop som använder metoden *AddNewFilm*, som lägger till en ny film.

Det första i *AddNewFilm* är att det kontrolleras så användaren är autentiserad med en JWT-token, om detta är okej skickas anropet vidare till metoden. Metoden tar emot bodyn i anropet och lägger i en model efter klassen *CreateFilm*, som följer interfacet *ICreateFilm*. Skillnaden mellan klasserna *CreateFilm* och *Film* (där objektet senare ska hamna, för att sedan läggas till i databasen) är att i *CreateFilm* finns inte variabeln *FilmId* och ingen lista med *FilmCopies*, istället finns en int-variabel med *NumberOfCopies*. När modelen har kontrollerats att den är ok, så skickas den till en AutoMapper-profil för att göras om från en *CreateFilm* till en *Film* och hamnar i variabeln *film*. Efter detta läggs en tom lista av *FilmCopy*-klassen till sedan läggs filmens id till genom att kontrollera hur många filmer det finns i databasen och lägga till en på det numret. För att sedan lägga till listan med kopior på filmen skickas filmen och variabeln *NumberOfCopies* till en metod som ligger i *FilmRepository*. I denna metod finns en for-loop som loopar lika många gånger som *NumberOfCopies* och lägger till variabler i ett *FilmCopy*-objekt. Dessa objekt läggs sedan till i *FilmCopies*-listan och retunerar sedan filmen med en färdigfyld lista. Sedan sparas hela objektet till databasen och retuneras sedan tillbaka till användaren.

Jag tycker detta exempel är ganska bra på att visa hur jag har tänkt med repositorypattern och använda automapper för att ta emot ett visst objekt och sedan mappa om det till ett annat objekt som ska in i databasen. I andra metoder har jag använt mig av automapper för att kontrollera vad som skickas tillbaka till användaren för att t.ex. inte skicka tillbaka känslig information. Nästan alla mina klasser har även ett interface, med undantag för en del DTOs eller automapperprofiler.

# Implementation

I min lösning har jag ett antal externa/synliga resurser som representerar interna modeller. I de fall där en synlig resurs skickas till en cotroller/metod har det varit för att minimera fält som behövs fyllas i av användaren då vissa fält (så som ID) endast används av databasen eller av en viss metod för att hitta något i databasen. Det har även varit för att vissa fält fylls i av en metod, som i exemplet ovanför med filmkopiorna. I de fall där jag använder en annan resurs för att skicka ut data har det varit för att inte visa t.ex. känslig information (Så som användarens lösenord) eller information som inte får framgå på grund av kravlistan.

# Säkerhet

Mina säkerhetsåtgärder i applikationen är framförallt användandet av JWT-tokens. Bland annat har detta implementerats i vissa metoder, så som exemplet ovanför, men används också för inloggning i klientgränssnittet. Vid inloggning i klientgränssnittet sätts token i localstorage och tanken var att denna skulle användas i metoder för att autentisera användaren vid anrop till åtkomstpunkter där detta krävdes. Tyvärr hann jag inte så långt med varken klientgränssnitt eller API. I övrigt var tanken med inloggningen att om användaren skrev fel lösenord/användarnamn ska denna skickas till en sida där den blir upplyst om att fel uppgifter har uppgetts. Hann dessvärre inte med att lösa så att statuskoden som kommer tillbaka tas om han om och används på detta sätt. I dagsläget visas ingeting om användaren inte skriver rätt uppgifter, vilken förvisso löser uppgiften att användaren inte kommer in, men inte på ett särskilt snyggt sätt.
I vissa av åtkomstpunkterna används även usermanager och if-satser för att kontrollera att användaren faktiskt finns eller kontrollera om den som skickar anropet har rollen "Filmstudio" eller "Admin". 